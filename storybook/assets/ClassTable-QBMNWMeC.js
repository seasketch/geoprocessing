import{j as t}from"./jsx-runtime-qGIIFXMu.js";import{n as M}from"./helpers-BzaOjzWG.js";import"./ReportDecorator-CVkrvWea.js";import{k as S,b as T}from"./objective-Cx9S2_iI.js";import{p as B}from"./number-BYw_ucvH.js";import{v,H as V}from"./HorizontalStackedBar-BAux7rfy.js";import{T as R}from"./Table-BanuEKp9.js";import{L as w}from"./LayerToggle-CMkgBS93.js";import{R as G}from"./ReportTableStyled-DeNLJsmW.js";import{p as q}from"./styled-components.browser.esm-Bui9LJgA.js";import{T as L}from"./Tooltip-Dnjx2KNy.js";import{u as D}from"./useTranslation-BpTe-nno.js";import{I as z}from"./InfoCircleFill.esm-WQjR5DY7.js";import{C as P}from"./CheckCircleFill.esm-Dm2DhJsT.js";const F=(p,y)=>{if(p.objectiveId)return p.objectiveId;if(y){const a=S(p.classes,i=>i.classId)[y].objectiveId;if(a)return a}throw new Error(`Expected objectiveId for metricGroup or class ${y}`)},W=q(G)`
  .styled {
    font-size: 13px;
    td {
      padding: 6px 5px;
    }
  }
`,_=({rows:p,columnConfig:y,metricGroup:d,objective:a})=>{const{t:i}=D(),h=S(d.classes,u=>u.classId),c=M(p,["classId","metricId"]),b=Object.keys(c).map(u=>({classId:u})),N=(u=>{const A=100/u.length,O=i("Class"),E=i("Map"),H=i("Target"),$=i("Goal"),k=i("Value");return u.map(e=>{const f={width:`${e.width||A}%`,...e.colStyle?e.colStyle:{}};if(e.type==="class")return{Header:e.columnLabel||O,accessor:r=>{var s;return i((s=h[r.classId||"missing"])==null?void 0:s.display)||"missing"},style:f};if(e.type==="metricValue")return{Header:e.columnLabel||k,accessor:r=>{if(!e.metricId)throw new Error("Missing metricId in column config");const l=c[r.classId]&&c[r.classId][e.metricId]?c[r.classId][e.metricId][0].value:0,s=(()=>{var m;if(isNaN(l)){const g=(((m=h[r.classId||"missing"])==null?void 0:m.display)||"This feature class")+" not found in the selected planning area";return t.jsx(L,{text:g,placement:"bottom",offset:{horizontal:0,vertical:5},children:t.jsx(z,{size:14,style:{color:"#83C6E6"}})})}else return t.jsx(t.Fragment,{})})(),n=(()=>{const m=isNaN(l)?0:l;return e.valueFormatter?v(m,e.valueFormatter):m})();return t.jsxs(t.Fragment,{children:[n,e.valueLabel?` ${e.valueLabel}`:"",s]})},style:f};if(e.type==="metricChart")return{Header:e.columnLabel||" ",style:{textAlign:"center",...f},accessor:(r,l)=>{var j;if(!e.metricId)throw new Error("Missing metricId in column config");const s=c[r.classId]&&c[r.classId][e.metricId]?c[r.classId][e.metricId][0].value:0,n=(()=>{if(!a)return 0;if(Array.isArray(a)){const o=F(d,r.classId),x=Array.isArray(a)?T(o,a):a;return e.valueFormatter==="percent"?x.target*100:x.target}else return e.valueFormatter==="percent"?a.target*100:a.target})(),m=(((j=h[r.classId||"missing"])==null?void 0:j.display)||"This feature class")+" not found in the selected planning area",g={...e.chartOptions?e.chartOptions:{},rows:[[[e.valueFormatter==="percent"?s*100:s]]],rowConfigs:[{title:o=>t.jsxs(t.Fragment,{children:[isNaN(o)?t.jsx(L,{text:m,placement:"bottom",offset:{horizontal:0,vertical:5},children:t.jsx(z,{size:14,style:{color:"#83C6E6"}})}):n&&o>=n?t.jsx(P,{size:14,style:{color:"#78c679",paddingRight:5}}):t.jsx(t.Fragment,{}),B(isNaN(o)?0:o/100)]})}],max:100};let I;return typeof e.targetValueFormatter=="function"?I=e.targetValueFormatter(n,l,b.length):I=o=>l===b.length-1?`${H} - ${v(o/100,"percent0dig")}`:"",t.jsx("div",{style:{display:"flex",alignItems:"center"},children:t.jsx("div",{style:{flex:1},children:t.jsx(V,{blockGroupNames:["foo"],blockGroupStyles:[{backgroundColor:"#ACD0DE"}],showTitle:!0,showLegend:!1,showTargetLabel:!0,targetLabelPosition:"bottom",showTotalLabel:!1,barHeight:12,target:n||void 0,targetValueFormatter:I,...g})})})}};if(e.type==="metricGoal")return{Header:e.columnLabel||$,style:f,accessor:r=>{const l=F(d,r.classId),s=Array.isArray(a)?T(l,a):a;if(!s)throw new Error(`Missing objective for objectiveId ${l}`);return e.valueFormatter?v(s.target,e.valueFormatter):`${s.target}${e.valueLabel?` ${e.valueLabel}`:""}`}};if(e.type==="layerToggle")return{Header:e.columnLabel||E,style:{textAlign:"center",...f},accessor:(r,l)=>{const s=!d.layerId,n=d.layerId||h[r.classId].layerId;return s&&n?t.jsx(w,{simple:!0,size:"small",layerId:n,style:{marginTop:0,justifyContent:"center"}}):!s&&n&&l===0?t.jsx(w,{simple:!0,size:"small",layerId:n,style:{marginTop:0,justifyContent:"center"}}):t.jsx(t.Fragment,{})}};throw new Error(`Unexpected ClassTableColumnConfig type ${e.type}`)})})(y);return t.jsx(W,{children:t.jsx(R,{className:"styled",columns:N,data:b})})};_.__docgenInfo={description:`Table displaying class metrics, one class per table row.  Having more than one metric per class may yield unexpected results
Returns 0 value in table when faced with a 'missing' metric instead of erroring
Handles "class has no value" NaN situation (common when sketch doesn't overlap with a geography) by overwriting with 0 and adding information circle`,methods:[],displayName:"ClassTable",props:{rows:{required:!0,tsType:{name:"Array",elements:[{name:"z.infer",elements:[{name:"metricSchema"}],raw:"z.infer<typeof metricSchema>"}],raw:"Metric[]"},description:"Table row objects, each expected to have a classId and value."},metricGroup:{required:!0,tsType:{name:"z.infer",elements:[{name:"metricGroupSchema"}],raw:"z.infer<typeof metricGroupSchema>"},description:"Source for metric class definitions. if group has layerId at top-level, will display one toggle for whole group"},objective:{required:!1,tsType:{name:"union",raw:"Objective | Objective[]",elements:[{name:"z.infer",elements:[{name:"objectiveSchema"}],raw:"z.infer<typeof objectiveSchema>"},{name:"Array",elements:[{name:"z.infer",elements:[{name:"objectiveSchema"}],raw:"z.infer<typeof objectiveSchema>"}],raw:"Objective[]"}]},description:"Optional objective for metric"},columnConfig:{required:!0,tsType:{name:"Array",elements:[{name:"ClassTableColumnConfig"}],raw:"ClassTableColumnConfig[]"},description:"configuration of one or more columns to display"}}};export{_ as C};
